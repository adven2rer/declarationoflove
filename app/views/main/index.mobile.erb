<div class="container">
	<div class="row">
		<div align="center">
		      <% if @saved == false %> 
		          <div class="panel panel-danger" style="margin-top:2%">
		              <div class="panel-heading">
		                  <div class="panel-title">
		                    Ошибка!
		                  </div>
		              </div>
	                  <div class="panel-body">
	                      Вы не можете публиковать сообщения чаще, чем 1 раз в минуту.
	                  </div>
		              </div>
		          </div>
		      <% end %>

			<%= form_for :message do |f| %>
					<% if @new_message != nil and not @new_message.valid? %>
						<div id="error_explanation">
						
							<h2><%= @new_message.errors.count %>
							
								<% if @new_message.errors.count == 1 %>
									ошибка 
								<% end %>

								<% if @new_message.errors.count > 1 %>
									ошибки
								<% end %>

									помешали сохранению вашего сообщения:

							</h2>

							<% @new_message.errors.full_messages.each do |msg| %>
								<li><%= msg %></li>
							<% end %>
						</div> 
					<% end %> 
			<% end %>
		</div>
				<div align="center">

					<!-- Button trigger modal -->
					<div align="center" style="margin-bottom:2%; margin-top:2%">
						<button class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">
					 	 ТОП-10 признаний
						</button>
					</div>

					<!-- Modal -->
					<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					  <div class="modal-dialog" style="padding-top:10%">
					    <div class="modal-content">
					      <div class="modal-header">
					        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					        <h4 class="modal-title" id="myModalLabel">ТОП-10 признаний</h4>
					      </div>
					      <div class="modal-body" align="center">
								<% if Message.all.empty? %>
									<h4>Пока ничего нет :(</h4>
								<% else %>
									<% Like.top_ten.each do |like| %>
											<% m = Message.find(like.message_id) %>
											<h4><strong><%= m.name %></strong>: <%= m.text %></h4>
											<span class="glyphicon glyphicon-thumbs-up" style="font-size:2.3em;color:RoyalBlue">
											</span>
											<x style="color:RoyalBlue"><%= like.karma %></x>	
								    <hr></hr>	
									<% end %>					
								<% end %>
					      </div>
					      <div class="modal-footer">
					        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
					      </div>
					    </div>
					  </div>
					</div>

					<% if Message.all.empty? %>
						<h2>Пока ничего нет :(</h2>
					<% end %>

						<% @messages.each do |message| %>
							<div class="panel panel-default">
							  <div class="panel-heading">
							    <div class="panel-title" align="left">
							    <%= image_tag "anonim.png", {height: 60, width: 60} %>
								<strong><%= message.name %></strong>:
							    </div>
							  </div>
							  <div class="panel-body">
							  	<%= message.text %>

							<p></p>

							<h6 style="color:grey"><%= time_ago_in_words(message.created_at) %> ago</h6>

							<%= form_tag do %>

									<%= hidden_field_tag :message_id, message.id %>

									<%= button_tag(name: "like_btn", type: "submit") do %>
										<i class="glyphicon glyphicon-thumbs-up" style="font-size:1.5em;color:MediumBlue"></i> 
									<% end %>

									<%= button_tag(name: "dislike_btn", type: "submit") do %>
										<i class="glyphicon glyphicon-thumbs-down" style="font-size:1.5em;color:Crimson"></i>
									<% end %>

							<% end %>

							<% if message.like != nil and message.like.karma != nil %>   
									<% l = message.like.karma %> 

									<% if l < 0 %>
										<h2 style="color:red">
										<%= l %>
										</h2>
									<% elsif l == 0 %>  
										<h2 style="color:grey">
										<%= l %>
										</h2>
									<% elsif l > 0 %>
										<h2 style="color:green">
										<%= l %> 
										</h2>
									<% end %>

							<% end %>

							<% if message.like == nil %>
								<h2 style="color:grey"> 0 </h2>
							<% end %>
					  </div>
					</div>
				    <% end %>
				</div>

				<div class="container" align="center">
					<% flash.each do |key, value| %>
						<div class="alert alert-<%= key %>" align="center"><%= value %></div>
					<% end %>
				</div>

				<div class="container">
					<%= yield %>
					<%= debug(params) if Rails.env.development? %>
				</div>

				<div class="row-fluid" align="center">
					<div class="span4 well">
						<%= form_for :message, :html => {:class => "form-horizontal"} do |m| %>
							<fieldset>
							<div class="control-group">
								<strong><h4>Ваше имя/псевдоним/выдуманное имя<small> (максимальная длина - 20 символов)</small></h4></strong>
								<%= m.text_field :name, :class => "form-control" %>
								<div class="controls">
								<h4>Ваше признание в любви/симпатии<small> (максимальная длина - 200 символов)</small></h4>
									<%= m.text_area :text, :class => "form-control", :rows => "3" %>
								</div>
							</div>
							<p></p>
							<div class="form-actions">
								<%= m.submit :class => "btn btn-default", :value => "Отправить", :name => "submit" %>
							</div>
							</fieldset>
						<% end %>
					</div>
				</div>

				<div align="center" style="padding-top:4%">
						<% if Message.pgcount > 6 %>
							<h5>Перейти на страницу...</h5>
							<%= form_tag do %> 
								<%= text_field_tag :page %>
								<%= button_tag(type: 'submit', class: "btn btn-default") do %>
									ОК
								<% end %>
							<% end %>
						<% end %>
				</div>

				<div align="center">
				<% if Message.pgcount > 1 %>
					<%= paginate(:short_list) %>
				<% end %>
				</div>
		</div>
</div>

<div class="container">
	<div align="center">
	<script type="text/javascript">(function() {
		  if (window.pluso)if (typeof window.pluso.start == "function") return;
		  if (window.ifpluso==undefined) { window.ifpluso = 1;
		    var d = document, s = d.createElement('script'), g = 'getElementsByTagName';
		    s.type = 'text/javascript'; s.charset='UTF-8'; s.async = true;
		    s.src = ('https:' == window.location.protocol ? 'https' : 'http')  + '://share.pluso.ru/pluso-like.js';
		    var h=d[g]('body')[0];
		    h.appendChild(s);
		  }})();</script>
		<div class="pluso" data-background="transparent" data-options="big,round,line,horizontal,nocounter,theme=04" data-services="vkontakte,facebook,twitter,google,bookmark" data-url="http://declarationoflove.herokuapp.com" data-title="Онлайн-сервис анонимных любовных признаний"></div>
		<hr></hr>
	</div>
</div>
	
	    <div align="center">
			<% if @visits_not_unique == 1%>
				<strong><i><%= @visits_not_unique %></i></strong> посещение за всё время
			<% elsif @visits_not_unique > 1 and @visits_not_unique < 5 %>
				<strong><i><%= @visits_not_unique %></i></strong> посещения за всё время
			<% elsif @visits_not_unique >= 5 and @visits_not_unique %>
				<strong><i><%= @visits_not_unique %></i></strong> посещений за всё время
			<% end %>

			<% if @visits_unique == 1 %>
				<p><strong><i><%= @visits_unique %></i></strong> уникальное посещение за всё время</p>
			<% elsif @visits_unique > 1 and @visits_unique < 5 %>
				<p><strong><i><%= @visits_unique %></i></strong> уникальных посещения за всё время</p>
			<% elsif @visits_unique >= 5 and @visits_unique %>
				<p><strong><i><%= @visits_unique %></i></strong> уникальных посещений за всё время</p>
			<% end %>
		</div>